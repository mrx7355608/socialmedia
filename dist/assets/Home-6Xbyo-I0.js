import{j as e,U as J,S as g,L as E,r,u as y}from"./index-w8OPScTq.js";import{s as x,a as V,u as T,b as P,c as z,f as U,E as G,d as W}from"./SuccessToast-ts7nQF6R.js";function S({error:t}){return e.jsx(e.Fragment,{children:t&&e.jsx("p",{className:"font-medium text-red-900 bg-red-200 w-full p-3 rounded-lg",children:t})})}S.propTypes={error:x};function _({content:t}){return e.jsx(e.Fragment,{children:t&&t.map((n,s)=>e.jsx(J,{user:n},s))})}_.propTypes={content:V};function K(){const{loading:t,error:n,resp:s}=T("/api/v1/friends");return e.jsxs("div",{className:"hidden w-full p-3 lg:flex flex-col gap-3 mb-6",children:[e.jsx("h1",{className:"text-gray-200 text-lg font-bold",children:"Friends"}),e.jsx("hr",{}),t&&e.jsx(g,{}),e.jsx(S,{error:n}),e.jsx(_,{content:s}),!t&&e.jsx(k,{friends:s})]})}function k({friends:t}){return e.jsx(e.Fragment,{children:t&&t.length>0?e.jsxs(E,{to:"/friends",className:"text-center text-blue-300 hover:underline",children:[" ","View More..."]}):e.jsx("p",{className:"text-gray-400",children:"No friends to show"})})}k.propTypes={friends:P};function Q(){const{loading:t,error:n,resp:s}=T("/api/v1/friends/pending-requests");return e.jsxs("div",{className:"hidden w-full p-3 lg:flex flex-col gap-3 mb-6",children:[e.jsx("h1",{className:"text-gray-200 text-md lg:text-lg font-bold",children:"Pending Requests"}),e.jsx("hr",{}),t&&e.jsx(g,{}),e.jsx(S,{error:n}),e.jsx(_,{content:s}),!t&&e.jsx($,{pendingRequests:s})]})}function $({pendingRequests:t}){return e.jsx(e.Fragment,{children:t&&t.length>0?e.jsxs(E,{to:"/pending-requests",className:"text-center text-blue-300 hover:underline",children:[" ","View More..."]}):e.jsx("p",{className:"text-gray-400",children:"No requests to show"})})}$.propTypes={pendingRequests:P};function X(){return e.jsxs("div",{className:"hidden fixed right-0 bottom-0 overflow-y-scroll lg:flex flex-col w-1/4",style:{top:"60px"},children:[e.jsx(K,{}),e.jsx(Q,{})]})}const Y={post:null,setPost:()=>null},M=r.createContext(Y),j=()=>r.useContext(M);function Z({children:t}){const[n,s]=r.useState(null);return e.jsx(M.Provider,{value:{post:n,setPost:s},children:t})}function ee(){const{post:t}=j();return e.jsx("div",{onClick:n,children:"Edit"});function n(){document.getElementById(`edit_post_${t==null?void 0:t._id}`).showModal()}}function te(){const{post:t}=j();return e.jsx("div",{onClick:n,className:"text-red-400",children:"Delete"});function n(){document.getElementById(`delete_post_${t==null?void 0:t._id}`).showModal()}}function se(){const{user:t}=y(),{post:n}=j();return e.jsx(e.Fragment,{children:(t==null?void 0:t._id)===(n==null?void 0:n.author._id)?e.jsxs("div",{className:"dropdown absolute top-1 right-2",children:[e.jsx("div",{tabIndex:0,role:"button",className:"btn btn-ghost m-1 rounded-full",children:e.jsx("img",{src:"/menu.png",alt:"menu icon",className:"w-5 h-5 object-cover rounded-full rotate-90"})}),e.jsxs("ul",{tabIndex:0,className:"dropdown-content z-[1] menu p-2 shadow-md bg-gray-700 rounded-box w-52",children:[e.jsx("li",{children:e.jsx(ee,{})}),e.jsx("li",{children:e.jsx(te,{})})]})]}):null})}function ne(){const{post:t}=j();return e.jsxs("div",{className:"w-full flex items-center",children:[e.jsx("img",{src:t==null?void 0:t.author.profilePicture,alt:"post author picture",className:"w-10 h-10 object-cover rounded-full inline mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-300 font-medium",children:t==null?void 0:t.author.fullname}),e.jsxs("p",{className:"text-gray-500 font-medium text-xs",children:["Posted on ",new Date(t==null?void 0:t.createdAt).toDateString()]})]})]})}const re={comments:[],setComments:()=>null},A=r.createContext(re),v=()=>r.useContext(A);function oe({children:t}){const[n,s]=r.useState([]);return e.jsx(A.Provider,{value:{comments:n,setComments:s},children:t})}function ie(){const{user:t}=y(),{post:n}=j(),{setComments:s}=v(),[o,i]=r.useState(""),[m,u]=r.useState(!1);return e.jsx("form",{onSubmit:d,className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-center p-3 absolute bottom-0 left-0 w-full",children:[e.jsx("img",{alt:"Tailwind CSS chat bubble component",src:t==null?void 0:t.profilePicture,className:"rounded-full object-cover w-10 h-10"}),e.jsx("input",{type:"text",placeholder:"Type here",className:"input input-bordered w-full mx-3",onChange:l,value:o}),m?e.jsx("button",{className:"btn btn-success",children:e.jsx(g,{})}):e.jsx("button",{type:"submit",className:"btn btn-success",children:"Post"})]})});function l(a){const{value:c}=a.target;i(c)}async function d(a){if(a.preventDefault(),!o.trim())return;const c=`/api/v1/comments/${n._id}`,h={method:"POST",credentials:"include",headers:{"Content-type":"application/json"},body:JSON.stringify({text:o})};try{u(!0),i("");const f=await(await fetch(c,h)).json();u(!1),f.ok&&s(b=>[f.data,...b])}catch{u(!1)}}}function D({comment:t}){const{setComments:n}=v(),[s,o]=r.useState(!1),[i,m]=r.useState("");return e.jsx(e.Fragment,{children:s?e.jsx("span",{className:"hover:underline hover:cursor-pointer",children:"Deleting..."}):i?e.jsx("span",{className:"text-red-400",children:i}):e.jsx("span",{onClick:u,className:"hover:underline hover:cursor-pointer",children:"Delete"})});async function u(){const l=`/api/v1/comments/${t._id}`,d={method:"DELETE",credentials:"include"};try{o(!0);const a=await fetch(l,d);if(o(!1),a.ok)n(c=>c.filter(h=>t._id!==h._id));else{const c=await a.json();m(c.error)}}catch{o(!1)}}}D.propTypes={comment:{_id:x,text:x,author:{_id:x,profilePicture:x,fullname:x}}};function L({comment:t}){const{user:n}=y(),[s,o]=r.useState(!1),[i,m]=r.useState(t.text),[u,l]=r.useState(t),[d,a]=r.useState(!1),[c,h]=r.useState("");return e.jsxs("div",{className:"flex gap-5 items-center mt-4",children:[e.jsx("div",{className:"avatar",children:e.jsx("div",{className:"w-10 rounded-full",children:e.jsx("img",{alt:"comment's author profile picture",src:t.author.profilePicture})})}),e.jsxs("div",{className:"flex flex-col",style:{minWidth:"250px",maxWidth:"400px"},children:[e.jsxs("div",{className:"chat-bubble before:content-none rounded-lg",style:{borderEndStartRadius:"9px"},children:[e.jsx("p",{className:"font-medium text-gray-300",children:t.author.fullname}),s?e.jsxs("form",{onSubmit:b,children:[e.jsx("input",{type:"text",className:"input input-bordered bg-transparent w-full",name:"text",value:i,onChange:f}),!d&&e.jsx("button",{type:"submit",className:"hidden"})]}):e.jsx("p",{className:"text-gray-300",children:u.text})]}),(n==null?void 0:n._id)===t.author._id?e.jsxs("div",{className:"text-sm ml-1 mt-1",children:[e.jsx("span",{onClick:p,className:"mr-3 hover:underline hover:cursor-pointer",children:s?d?"Editing...":"Cancel":"Edit"}),e.jsx(D,{comment:t})]}):null]})]});function p(){o(!s)}function f(N){m(N.target.value)}async function b(N){N.preventDefault();const O=`/api/v1/comments/${t._id}`,q={method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:i})};try{a(!0);const w=await(await fetch(O,q)).json();a(!1),w.ok?(console.log(w.data),l(w.data),o(!1)):h(w.error)}catch{a(!1)}}}L.propTypes={comment:{_id:x,text:x,author:{_id:x,profilePicture:x,fullname:x}}};function le(){const{comments:t}=v();return e.jsx(e.Fragment,{children:e.jsx("div",{className:"p-4 overflow-y-auto",style:{height:"73%"},children:t.map(n=>e.jsx(L,{comment:n},n._id))})})}function B({showComments:t,setShowComments:n}){const{post:s}=j(),{setComments:o}=v(),[i,m]=r.useState(!1),[u,l]=r.useState("");return r.useEffect(()=>{t&&(m(!0),fetch(`/api/v1/comments/${s==null?void 0:s._id}`,{method:"GET",credentials:"include"}).then(d=>d.json()).then(d=>o(d.data)).catch(()=>l("An un-expected error occurred")).finally(()=>m(!1)))},[t,s==null?void 0:s._id,o]),e.jsx(e.Fragment,{children:e.jsx("dialog",{id:`my_modal_${s==null?void 0:s._id}`,className:"modal p-0 mx-auto",style:{width:"95vw"},children:e.jsxs("div",{className:"modal-box w-full lg:w-11/12 lg:max-w-4xl p-0 relative",style:{height:"90vh"},children:[e.jsx("h3",{className:"font-bold text-xl text-center mb-9 mt-5",children:"Comments"}),e.jsx("img",{src:"/close.png",alt:"close cross icon",onClick:()=>{document.getElementById(`my_modal_${s==null?void 0:s._id}`).close(),n(!1)},className:"hover:cursor-pointer p-2 w-8 h-8 rounded-full hover:bg-gray-700 object-cover absolute top-5 right-6"}),i?e.jsx(ae,{}):u?e.jsx(F,{errorMessage:u}):e.jsx(le,{}),e.jsx(ie,{})]})})})}B.propTypes={showComments:z,setShowComments:U};function F({errorMessage:t}){return e.jsx("div",{className:"flex items-center justify-center mx-auto w-1/2 min-h-screen",children:e.jsx("p",{className:"text-red-400 text-lg",children:t})})}F.propTypes={errorMessage:x};function ae(){return e.jsx("div",{className:"flex items-center justify-center mx-auto h-1/2",children:e.jsx(g,{})})}function ce(){const{post:t,setPost:n}=j(),[s,o]=r.useState(""),[i,m]=r.useState(!1),[u,l]=r.useState("");return r.useEffect(()=>{t&&o(t.content)},[t]),e.jsx("dialog",{id:`edit_post_${t==null?void 0:t._id}`,className:"modal mx-auto",style:{width:"95vw"},children:e.jsxs("div",{className:"modal-box w-full",children:[e.jsx("h3",{className:"font-bold text-xl text-center mb-10",children:"Edit Post"}),e.jsxs("div",{className:"flex items-center justify-center w-full max-w-md mx-auto",children:[e.jsx("textarea",{className:"textarea textarea-bordered w-full resize-none",value:s,onChange:a,rows:6}),e.jsx("p",{className:"text-red-500 mt-1",children:u})]}),e.jsxs("div",{className:"modal-action",children:[i?e.jsx("button",{className:"btn btn-primary",children:e.jsx(g,{})}):e.jsx("button",{className:"btn btn-primary",onClick:d,children:"Edit"}),e.jsx("button",{className:"btn",onClick:c,children:"Cancel"})]})]})});async function d(){if(!s)return l("Nothing to edit");const h=`/api/v1/posts/${t==null?void 0:t._id}`,p={method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:s})};try{m(!0);const b=await(await fetch(h,p)).json();m(!1),b.ok?(n(N=>({...N,content:b.data.content})),c()):l(b.error)}catch{l("An un-exepected error occurred"),m(!1)}}function a(h){const{value:p}=h.target;o(p)}function c(){document.getElementById(`edit_post_${t==null?void 0:t._id}`).close()}}const de={timeline:[],setTimeline:()=>null},I=r.createContext(de),C=()=>r.useContext(I);function ue({children:t}){const[n,s]=r.useState([]);return e.jsx(I.Provider,{value:{timeline:n,setTimeline:s},children:t})}function me(){const{post:t}=j(),{setTimeline:n}=C(),[s,o]=r.useState(!1);return e.jsx("dialog",{id:`delete_post_${t==null?void 0:t._id}`,className:"modal mx-auto",style:{width:"95vw"},children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-xl text-center mb-10",children:"Delete Post"}),e.jsx("p",{children:"Are you sure you want to delete this post?"}),e.jsxs("div",{className:"modal-action",children:[s?e.jsx("button",{className:"btn btn-error",children:e.jsx(g,{})}):e.jsx("button",{onClick:m,className:"btn btn-error",children:"Delete"}),e.jsx("button",{className:"btn btn-ghost",onClick:i,children:"No"})]})]})});function i(){document.getElementById(`delete_post_${t==null?void 0:t._id}`).close()}async function m(){const l=`/api/v1/posts/${t._id}`,d={method:"DELETE",credentials:"include"};try{o(!0);const a=await fetch(l,d);if(o(!1),a.ok)u(t._id);else{const c=await a.json();alert(c.error)}}catch{alert("An un-expected error occurred"),o(!1)}}function u(l){n(d=>d.filter(a=>a._id!==l))}}function xe(){const{post:t,setPost:n}=j(),{user:s}=y(),[o,i]=r.useState("");return e.jsxs(e.Fragment,{children:[t!=null&&t.likes.includes(s==null?void 0:s._id)?e.jsxs("button",{className:"btn btn-primary flex-1 text-white",onClick:u,children:[e.jsx("img",{src:"/like.png",alt:"like icon",className:"inline w-5 h-5"}),"Liked"]}):e.jsxs("button",{className:"btn btn-ghost flex-1",onClick:m,children:[e.jsx("img",{src:"/like.png",alt:"like icon",className:"inline w-5 h-5"}),"Like"]}),o&&e.jsx(G,{error:o})]});async function m(){const l=`/api/v1/posts/like/${t==null?void 0:t._id}`,d={method:"PATCH",credentials:"include"};try{const c=await(await fetch(l,d)).json();c.ok===!1?(i(c.error),setTimeout(()=>i(""),4e3)):n({...t,likes:c.data})}catch{i("An un-expected error occurred"),setTimeout(()=>i(""),4e3)}}async function u(){const l=`/api/v1/posts/dislike/${t==null?void 0:t._id}`,d={method:"PATCH",credentials:"include"};try{const c=await(await fetch(l,d)).json();c.ok===!1?(i(c.error),setTimeout(()=>i(""),4e3)):n({...t,likes:c.data})}catch{i("An un-expected error occurred"),setTimeout(()=>i(""),4e3)}}}function H({post:t}){const{post:n,setPost:s}=j(),[o,i]=r.useState(!1);return r.useEffect(()=>{t&&s(t)},[t,s]),e.jsxs("div",{className:"relative flex flex-col items-start justify-start bg-gray-800 p-4 rounded-lg mb-4 w-full shadow-lg",children:[e.jsx(ne,{}),e.jsx("p",{className:"text-gray-300 mt-5",style:{whiteSpace:"pre-line"},children:n==null?void 0:n.content}),e.jsxs("div",{className:"flex gap-2 w-full mt-4",children:[e.jsx(xe,{}),e.jsxs("button",{className:"btn btn-ghost flex-1",onClick:()=>{i(!0),document.getElementById(`my_modal_${n._id}`).showModal()},children:[e.jsx("img",{src:"/comment.png",alt:"like icon",className:"inline w-5 h-5"}),"Comment"]})]}),e.jsx(se,{}),e.jsx(oe,{children:e.jsx(B,{showComments:o,setShowComments:i})}),e.jsx(ce,{}),e.jsx(me,{})]})}H.propTypes={post:{_id:x,content:x,author:{_id:x,profilePicture:x,fullname:x},createdAt:W,likes:P}};function he(){const[t,n]=r.useState(!1),[s,o]=r.useState(""),{setTimeline:i}=C();return r.useEffect(()=>{n(!0),fetch("/api/v1/posts/timeline",{method:"GET",credentials:"include"}).then(l=>l.json()).then(l=>i(l.data)).catch(()=>o("dsfad")).finally(()=>n(!1))},[n,i]),{loading:t,error:s}}function fe(){const{timeline:t}=C(),{loading:n,error:s}=he();return n?e.jsx("div",{className:"flex items-center justify-center mx-auto w-1/2 min-h-screen",children:e.jsx(g,{})}):s?e.jsx("div",{className:"flex items-center justify-center mx-auto w-1/2 min-h-screen",children:e.jsx("p",{className:"text-red-400 text-lg",children:s})}):e.jsx(e.Fragment,{children:t.map(o=>e.jsx(Z,{children:e.jsx(H,{post:o})},o._id))})}function je(){const{user:t}=y(),{timeline:n,setTimeline:s}=C(),[o,i]=r.useState(""),[m,u]=r.useState(""),[l,d]=r.useState(!1);return e.jsxs("div",{className:"flex flex-col justify-start w-full p-4 bg-gray-800 rounded-lg mb-4",children:[e.jsxs("div",{className:"flex items-start w-full",children:[e.jsx("img",{src:t==null?void 0:t.profilePicture,alt:"user picture",className:"w-10 h-10 rounded-full object-cover mr-4"}),e.jsxs("div",{className:"w-full",children:[e.jsx("textarea",{className:"textarea textarea-bordered textarea-md bg-transparent w-full resize-none",placeholder:"Share your thougts",rows:3,onChange:c=>i(c.target.value)}),m&&e.jsx("p",{className:"text-red-500 mt-1",children:m})]})]}),l?e.jsx("button",{className:"btn btn-success w-24 ml-auto mt-3",children:e.jsx(g,{})}):e.jsx("button",{onClick:a,className:"btn btn-success w-24 ml-auto mt-3",children:"Post"})]});async function a(){const c="/api/v1/posts",h={method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:o})};try{d(!0);const f=await(await fetch(c,h)).json();d(!1),f.ok?s([f.data,...n]):(u(f.error),setTimeout(()=>u(""),4e3))}catch{u("An un-expected error occurred"),setTimeout(()=>u(""),4e3),d(!1)}}}function be(){return e.jsxs("div",{className:"px-3 py-0 w-full lg:w-1/3 mx-auto mt-5 overflow-hidden",children:[e.jsx(X,{}),e.jsx("div",{className:"flex flex-col items-center justify-start min-h-screen",children:e.jsxs(ue,{children:[e.jsx(je,{}),e.jsx(fe,{})]})})]})}export{be as default};
